{"version":3,"sources":["ngCacheService.js"],"names":["angular","module","factory","$window","$q","$timeout","cacheStorage","repository","POLY_FILL","name","dbName","entityName","options","db","open","deferred","defer","resolve","promise","save","setItem","key","value","savedStatus","removeItem","maxAge","console","warn","get","getItem","data","remove","hasOwnProperty","reject","length","size","clear","log","e","storeQuotaExceeded","quotaExceeded","code","number","saveHandle","storeType","clearCache","e1","deletedCacheCount","storeKey","deletableCacheItems","cancel","then","incrementDeletedCache","e2","error","localStorageDB","localStorage","localSessionStorage","sessionStorage","localIndexedDB","version","indexedDB","IndexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","errorMessage","IDBTransaction","webkitIDBTransaction","msIDBTransaction","IDBKeyRange","webkitIDBKeyRange","msIDBKeyRange","request","onupgradeneeded","target","result","transaction","onerror","objectStoreNames","contains","deleteObjectStore","createObjectStore","onsuccess","message","trans","objectStore","put","storageRequestSuccess","used","remaining","storageRequestFailure","navigator","webkitTemporaryStorage","queryUsageAndQuota","webkitStorageInfo","TEMPORARY","onblocked","count","localWebSQL","dbDescription","dbSize","entitySize","openDatabase","tx","createTable","executeSql","onfailure","SYNTAX_ERR","insertData","oninsertsuccess","selectData","rows","item","cacheValue","flush","deleteData","status","deleteTable","tableSize","Size","storageExist","storageType","uid","Date","valueOf","toString","savePromise","store","lsdbSavedStatus","lssdbSavedStatus","description","cacheType","LOCAL_STORAGE","SESSION_STORAGE","INDEXED_DB","WEB_SQL","storage","getStorage","init","initData","indexedDBPreprocessor","info","webSQLPreprocessor","localStoragePreprocessor","sessionStoragePreprocessor","polyFillPreprocessor","toJson","lidb","lwdb","lsdb","lssdb","singleton","prototype","instance","getNewInstance","create"],"mappings":"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","file":"angular-cache-service.min.js","sourcesContent":["/**\r\n * version: 0.0.1\r\n * 10-09-2015 \r\n * The cache service handles client-side caching (almost about any object can\r\n * be cached on the client). The cache mechanism implemented by this service\r\n * uses either { indexedDB | webSQL | localStorage | sessionStorage | polyFill }\r\n * in the specified order of availability. To ensure better performance, when\r\n * used in pagination, only pages navigated by users shoube be cached. For example: in\r\n * a page 1 to 10 result; if user navigate page 1, 3 and 7; only the mentioned\r\n * three pages (1, 3 & 7) should be cached....however it's still up to you to determine what's cached.\r\n */\r\nangular.module(\"a2o4.storage\", [])\r\n/**\r\n * @param {$window} The window object.\r\n * @param {$q} The deferred object.\r\n * @param {$q} The timeout object.\r\n */\r\n.factory(\"cacheService\", [ \"$window\", \"$q\", \"$timeout\", function($window, $q, $timeout) {\r\n   var cacheStorage = function() {\r\n   };\r\n   \r\n   var repository = function() {\r\n         /**\r\n          * This POLY_FILL serves as an extension of browser storage capability. It\r\n          * would automatically be used should any of the following not be available { indexedDB | webSQL | localStorage | sessionStorage }\r\n          */\r\n        var POLY_FILL = {};\r\n           // marker for POLY_FILL\r\n           POLY_FILL.name = \"POLY_FILL\";\r\n           // database name\r\n           POLY_FILL.dbName = \"cacheDB\";\r\n           // entity name\r\n           POLY_FILL.entityName = \"cacheTable\";\r\n           // poly fill options\r\n           POLY_FILL.options = {};\r\n           // poly fill storage space\r\n           POLY_FILL.db = {};\r\n           \r\n            // return reference to poly fill\r\n           POLY_FILL.open = function() {\r\n                var deferred = $q.defer();\r\n                // update dbName and entityName on DB open\r\n                POLY_FILL.dbName = POLY_FILL.options.dbName;\r\n                POLY_FILL.entityName = POLY_FILL.options.entityName;\r\n                $timeout(function() {\r\n                   deferred.resolve(POLY_FILL);\r\n                });\r\n                return deferred.promise;\r\n             };\r\n            /** \r\n             * Function for caching a data. \r\n             * key must be truthy -> not (null | undefined | NaN | \"\" | 0 | false)\r\n             * @param {key} the key for data to be cached\r\n             * @param {value} the actual data to cache\r\n             */\r\n            POLY_FILL.save = POLY_FILL.setItem = function(key, value) {\r\n              var deferred = $q.defer(),\r\n                 savedStatus = false;\r\n              \r\n              if (key) {\r\n                 POLY_FILL.db[key] = value;\r\n                 savedStatus = true;\r\n                 \r\n                 // invalidate current cached page after specified max period\r\n                 $timeout(function() {\r\n                    POLY_FILL.removeItem(key);\r\n                 }, POLY_FILL.options.maxAge);\r\n              } else {\r\n                 console.warn(\"key should be a valid truthy\");\r\n              }\r\n              \r\n              $timeout(function() {\r\n                 deferred.resolve(savedStatus);\r\n              });\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to retrieve existing cache data\r\n            * key must be defined\r\n            * @param {key} the key for data to be retrieved\r\n            */\r\n           POLY_FILL.get = POLY_FILL.getItem = function(key) {\r\n              var deferred = $q.defer();\r\n              var data = POLY_FILL.db[key];\r\n              \r\n              if (data) {\r\n                 $timeout(function() {\r\n                    deferred.resolve(data);\r\n                 });\r\n              } else {\r\n                 $timeout(function() {\r\n                   deferred.resolve(null);\r\n                 });\r\n              }\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to delete an existing cache data\r\n            * key must be defined and part of exisiting keys\r\n            * @param {key} the key for data to be deleted\r\n            */\r\n           POLY_FILL.remove = POLY_FILL.removeItem = function(key) {\r\n              var deferred = $q.defer();\r\n              if (POLY_FILL.db.hasOwnProperty(key)) {\r\n                 // delete POLY_FILL.db[key];\r\n                 POLY_FILL.db[key] = null;\r\n                 $timeout(function() {\r\n                    deferred.resolve();\r\n                 });\r\n              } else {\r\n                 deferred.reject();\r\n              }\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to compute current size of cache, as per number of cache items\r\n            */\r\n           POLY_FILL.length = function() {\r\n              var deferred = $q.defer(),\r\n                 size = 0,\r\n                 key;\r\n              \r\n                for (key in POLY_FILL.db) {\r\n                   // exclude function properties from size counting\r\n                   if (POLY_FILL.db.hasOwnProperty(key)) {\r\n                       size++;\r\n                   } \r\n                }\r\n                \r\n                $timeout(function() {\r\n                   deferred.resolve(size);\r\n                });\r\n                \r\n                return deferred.promise;\r\n            };\r\n            /** \r\n             * Function to clear entire cache space\r\n             */\r\n            POLY_FILL.clear = function() {\r\n              var deferred = $q.defer(),\r\n                 key;\r\n              \r\n              try {\r\n                 for (key in POLY_FILL.db) {\r\n                    // exclude function properties as keys for data removal\r\n                    if (POLY_FILL.db.hasOwnProperty(key)) {\r\n                        delete POLY_FILL.db[key];\r\n                    }\r\n                 }\r\n                 \r\n                 console.log('POLY_FILL ' + POLY_FILL.dbName + ' data cleared');\r\n                 $timeout(function() {\r\n                    deferred.resolve();\r\n                 });\r\n              } catch (e) {\r\n                $timeout(function() {\r\n                   deferred.reject();\r\n                });\r\n              }\r\n              \r\n              return deferred.promise;\r\n            };\r\n         \r\n        /**\r\n          * Utiltiy function for verifying whether client storage ($window.localStorage | $window.sessionStorage) space is filled to\r\n          * capacity\r\n          *\r\n          * @param {e} error thrown\r\n          */\r\n        var storeQuotaExceeded = function(e) {\r\n           var quotaExceeded = false;\r\n           if (e) {\r\n               if (e.code) {\r\n                 switch (e.code) {\r\n                   case 22:\r\n                     quotaExceeded = true;\r\n                     break;\r\n                   case 1014:\r\n                     // Firefox\r\n                     if (e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\r\n                       quotaExceeded = true;\r\n                     }\r\n                     break;\r\n                 }\r\n               } else if (e.number === -2147024882) {\r\n                 // Internet Explorer 8\r\n                 quotaExceeded = true;\r\n               }\r\n           }\r\n           return quotaExceeded;\r\n        };\r\n        \r\n        /**\r\n         * Handles save request for localStorage and sessionStorage\r\n         * @param {storeType} the storage type {localStorage | localSessionStorage}\r\n         * @param {key} the key for caching data\r\n         * @param {value} the data to cache\r\n         */\r\n        var saveHandle = function(storeType, key, value) {\r\n           var clearCache;\r\n           try {\r\n              storeType.db.setItem(key, value);\r\n           } catch (e1) {\r\n              if (storeType.storeQuotaExceeded(e1)) {\r\n                 /* delete first n-cached items as specified by value of deletableCacheItems */\r\n                 var deletedCacheCount = 0;\r\n                 for (var storeKey in storeType.db) {\r\n                    if (storeType.db.getItem(storeKey)) {\r\n                      if (deletedCacheCount === storeType.options.deletableCacheItems) {\r\n                         break;\r\n                      }\r\n                      // clear timer if previously set\r\n                      if (clearCache) {\r\n                         $timeout.cancel(clearCache);\r\n                      }\r\n                      // delete cache data\r\n                      storeType.removeItem(storeKey).then(incrementDeletedCache);\r\n                    }\r\n                 }\r\n                 \r\n                 var incrementDeletedCache = function(){\r\n                    deletedCacheCount++;\r\n                 };                   \r\n              }\r\n              try {\r\n                 // perform a second attempt to cache current page\r\n                 storeType.db.setItem(key, value);\r\n              } catch (e2) {\r\n                 /*\r\n                   * looks like data might be too big or something weird happened....ignore caching of current page\r\n                   */\r\n                 console.error(\"error persisting data: \" + e2);\r\n                 return false;\r\n              }\r\n           }\r\n           \r\n           // invalidate current cached page after specified max period\r\n           clearCache = $timeout(function() {\r\n              storeType.removeItem(key);\r\n           }, storeType.options.maxAge);\r\n           \r\n           return true;\r\n        };\r\n        \r\n        /**\r\n         * This storage object help abstract the basic functionalities of localStorage.\r\n         */\r\n        var localStorageDB = {};\r\n           // marker for localStorage\r\n           localStorageDB.name = \"localStorage\";\r\n           // database name\r\n           localStorageDB.dbName = \"cacheDB\";\r\n           // entity name\r\n           localStorageDB.entityName = \"cacheTable\";\r\n           // db handle\r\n           localStorageDB.db = $window.localStorage;\r\n           // storage capacity check\r\n           localStorageDB.storeQuotaExceeded = storeQuotaExceeded;\r\n           // database options\r\n           localStorageDB.options = {};\r\n           \r\n           // return reference to localStorageDB.db\r\n           localStorageDB.open = function() {\r\n              var deferred = $q.defer();\r\n              // update dbName and entityName on DB open\r\n              localStorageDB.dbName = localStorageDB.options.dbName;\r\n              localStorageDB.entityName = localStorageDB.options.entityName;\r\n              $timeout(function() {\r\n                 deferred.resolve(localStorageDB.db);\r\n              });\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function for caching a data. \r\n            * key must be truthy -> not (null | undefined | NaN | \"\" | 0 | false)\r\n            * @param {key} the key for data to be cached\r\n            * @param {value} the actual data to cache\r\n            */\r\n           localStorageDB.save = localStorageDB.setItem = function(key, value) {\r\n              var deferred = $q.defer();\r\n              \r\n              if (key) {\r\n                 var savedStatus = saveHandle(localStorageDB, key, value);\r\n                 deferred.resolve(savedStatus);\r\n              } else {\r\n                 deferred.reject();\r\n              }\r\n              \r\n              return deferred.promise;\r\n            };\r\n            /** \r\n             * Function to retrieve existing cache data\r\n             * key must be defined\r\n             * @param {key} the key for data to be retrieved\r\n             */\r\n            localStorageDB.get = localStorageDB.getItem = function(key) {\r\n              var deferred = $q.defer();\r\n              \r\n              data = localStorageDB.db.getItem(key);\r\n              deferred.resolve(data);\r\n              \r\n              return deferred.promise;\r\n            };\r\n            /** \r\n             * Function to delete an existing cache data\r\n             * key must be defined and part of exisiting keys\r\n             * @param {key} the key for data to be deleted\r\n             */\r\n            localStorageDB.remove = localStorageDB.removeItem = function(key) {\r\n              var deferred = $q.defer();\r\n              \r\n              localStorageDB.db.removeItem(key);\r\n              deferred.resolve();\r\n              \r\n              return deferred.promise;\r\n            };\r\n            /** \r\n             * Function to compute current size of cache, as per number of cache items\r\n             */\r\n            localStorageDB.length = function() {\r\n              var deferred = $q.defer(),\r\n                  size = 0;\r\n                    \r\n                size = localStorageDB.db.length;\r\n                deferred.resolve(size);\r\n                \r\n                return deferred.promise;\r\n            };\r\n            /** \r\n             * Function to clear entire cache space\r\n             */\r\n            localStorageDB.clear = function() {\r\n              var deferred = $q.defer();\r\n              \r\n              localStorageDB.db.clear();\r\n              deferred.resolve();\r\n              console.log(\"localStorageDB data cleared\");\r\n              \r\n              return deferred.promise;\r\n            };\r\n            \r\n        /**\r\n         * This storage object help abstract the basic functionalities of sessionStorage.\r\n         */\r\n        var localSessionStorage = {};\r\n           // marker for localStorage\r\n           localSessionStorage.name = \"sessionStorage\";\r\n           // database name\r\n           localSessionStorage.dbName = \"cacheDB\";\r\n           // entity name\r\n           localSessionStorage.entityName = \"cacheTable\";\r\n           // db handle\r\n           localSessionStorage.db = $window.sessionStorage;\r\n           // storage capacity check\r\n           localSessionStorage.storeQuotaExceeded = storeQuotaExceeded;\r\n           // database options\r\n           localSessionStorage.options = {};\r\n           \r\n           // return reference to localSessionStorage.db\r\n           localSessionStorage.open = function() {\r\n              var deferred = $q.defer();\r\n              // update dbName and entityName on DB open\r\n              localSessionStorage.dbName = localSessionStorage.options.dbName;\r\n              localSessionStorage.entityName = localSessionStorage.options.entityName;\r\n              $timeout(function() {\r\n                 deferred.resolve(localSessionStorage.db);\r\n              });\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function for caching a data. \r\n            * key must be truthy -> not (null | undefined | NaN | \"\" | 0 | false)\r\n            * @param {key} the key for data to be cached\r\n            * @param {value} the actual data to cache\r\n            */\r\n           localSessionStorage.save = localSessionStorage.setItem = function(key, value) {\r\n              var deferred = $q.defer();\r\n              \r\n              if (key) {\r\n                 var savedStatus = saveHandle(localSessionStorage, key, value);\r\n                 deferred.resolve(savedStatus);\r\n              } else {\r\n                 deferred.reject();\r\n              }\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to retrieve existing cache data\r\n            * key must be defined\r\n            * @param {key} the key for data to be retrieved\r\n            */\r\n           localSessionStorage.get = localSessionStorage.getItem = function(key) {\r\n              var deferred = $q.defer();\r\n              \r\n              data = localSessionStorage.db.getItem(key);\r\n              deferred.resolve(data);\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to delete an existing cache data\r\n            * key must be defined and part of exisiting keys\r\n            * @param {key} the key for data to be deleted\r\n            */\r\n           localSessionStorage.remove = localSessionStorage.removeItem = function(key) {\r\n              var deferred = $q.defer();\r\n              \r\n              localSessionStorage.db.removeItem(key);\r\n              deferred.resolve();\r\n              console.log(\"localSessionStorage data cleared\");\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to compute current size of cache, as per number of cache items\r\n            */\r\n           localSessionStorage.length = function() {\r\n              var deferred = $q.defer(),\r\n                  size = 0;\r\n                    \r\n              size = localSessionStorage.db.length;\r\n              deferred.resolve(size);\r\n                \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to clear entire cache space\r\n            */\r\n           localSessionStorage.clear = function() {\r\n              var deferred = $q.defer();\r\n              \r\n              localSessionStorage.db.clear();\r\n              deferred.resolve();\r\n                \r\n              return deferred.promise;\r\n           };\r\n\r\n           /**\r\n            * This storage object help abstract the basic functionalities of IndexDB.\r\n            */\r\n           var localIndexedDB = {};\r\n           // database version\r\n           localIndexedDB.version = 1;\r\n           // marker for localIndexedDB\r\n           localIndexedDB.name = \"indexedDB\";\r\n           // database name\r\n           localIndexedDB.dbName = \"cacheDB\";\r\n           // entity name\r\n           localIndexedDB.entityName = \"cacheTable\";\r\n           // database options\r\n           localIndexedDB.options = {};\r\n\r\n           // open the database and configure it appropraitely\r\n           localIndexedDB.open = function() {\r\n              var deferred = $q.defer();\r\n              // update dbName and entityName on DB open\r\n              localIndexedDB.dbName = localIndexedDB.options.dbName;\r\n              localIndexedDB.entityName = localIndexedDB.options.entityName;\r\n              \r\n              if (localIndexedDB.db) {\r\n                 $timeout(function() {\r\n                    deferred.resolve(localIndexedDB.db);\r\n                 });\r\n                 \r\n                 return deferred.promise;\r\n              }\r\n              \r\n              if (!($window.indexedDB = $window.IndexedDB || $window.mozIndexedDB || $window.webkitIndexedDB || $window.msIndexedDB)) {\r\n                 var errorMessage = \"indexedDB not supported on this device\";\r\n                 console.warn(errorMessage);\r\n                 $timeout(function() {\r\n                   deferred.resolve(null);\r\n                 });\r\n                 return deferred.promise;\r\n               }\r\n              // use appropriate browser prefix\r\n              if ('webkitIndexedDB' in $window) {\r\n                 $window.IDBTransaction = $window.IDBTransaction || $window.webkitIDBTransaction || $window.msIDBTransaction;\r\n                 $window.IDBKeyRange = $window.IDBKeyRange || $window.webkitIDBKeyRange || $window.msIDBKeyRange;\r\n              }\r\n              \r\n              var request = $window.indexedDB.open(localIndexedDB.dbName, localIndexedDB.version);\r\n\r\n              /* this is called once for when creating/upgrading localIndexedDB.db we can only create Object stores in a version-change transaction. */\r\n              request.onupgradeneeded = function(e) {\r\n                 var db = e.target.result;\r\n                 // handle for the actual indexedDB database\r\n                 localIndexedDB.db = db;\r\n\r\n                 e.target.transaction.onerror = $window.indexedDB.onerror;\r\n\r\n                 if (db.objectStoreNames.contains(localIndexedDB.entityName)) {\r\n                    db.deleteObjectStore(localIndexedDB.entityName);\r\n                 }\r\n\r\n                 db.createObjectStore(localIndexedDB.entityName);\r\n                 console.log(localIndexedDB.dbName + \" indexedDB database created with store: \" + localIndexedDB.entityName);\r\n              };\r\n\r\n              /* invoked when after localIndexedDB.db has opened and all version-changes completed */\r\n              request.onsuccess = function(e) {\r\n                 localIndexedDB.db = e.target.result;\r\n                 $timeout(function() {\r\n                    deferred.resolve(localIndexedDB.db);\r\n                 });\r\n              };\r\n\r\n              request.onerror = function(e) {\r\n                  var errorMessage = \"device might be operating incognito. localIndexedDB couldn't be created/opened. error: \" + e.message;\r\n                  console.warn(errorMessage);\r\n                 \r\n                  $timeout(function() {\r\n                     deferred.resolve(null);\r\n                 });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function for caching a data. \r\n            * key must be truthy -> not (null | undefined | NaN | \"\" | 0 | false)\r\n            * @param {key} the key for data to be cached\r\n            * @param {value} the actual data to cache\r\n            */\r\n           localIndexedDB.save = localIndexedDB.setItem = function(key, value) {\r\n              var deferred = $q.defer();\r\n              if (!key) {\r\n                 deferred.reject(\"invalid key\");\r\n                 return deferred.promise;\r\n              }\r\n\r\n              var db = localIndexedDB.db;\r\n              if (!db) {\r\n                  var errorMessage = \"localIndexedDB is not available\";\r\n                  console.warn(errorMessage);\r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n                 return deferred.promise;\r\n              }\r\n\r\n              // use entity object store in read-write manner\r\n              var trans = db.transaction([localIndexedDB.entityName], \"readwrite\");\r\n              var objectStore = trans.objectStore(localIndexedDB.entityName);\r\n              var request = objectStore.put(value, key);\r\n              var savedStatus = false;\r\n              \r\n              request.onsuccess = function(e) {\r\n                 if (e.target.result) {\r\n                    savedStatus = true;\r\n                    // invalidate current cached page after specified max period\r\n                    $timeout(function() {\r\n                       localIndexedDB.removeItem(key);\r\n                    }, localIndexedDB.options.maxAge);\r\n                 }\r\n                 \r\n                 $timeout(function() {\r\n                    deferred.resolve(savedStatus);\r\n                 });\r\n              };\r\n\r\n              request.onerror = function(e) {\r\n                  var errorMessage = value + \" couldn't be saved. error: \" + e.message;\r\n                  console.warn(errorMessage);\r\n                  \r\n                  var storageRequestSuccess = function(used, remaining) {\r\n                    console.log(\"used quota: \" + used + \", remaining quota: \" + remaining);\r\n                  };\r\n                  var storageRequestFailure = function(e) {\r\n                    console.log('error requesting storage space: ' + e.message); \r\n                  };\r\n                  \r\n                  // check if error is due to quota limit\r\n                  if ($window.navigator.webkitTemporaryStorage) {\r\n                    $window.navigator.queryUsageAndQuota(storageRequestSuccess, storageRequestFailure);\r\n                  } else {\r\n                     $window.webkitStorageInfo.queryUsageAndQuota($window.webkitStorageInfo.TEMPORARY, storageRequestSuccess, storageRequestFailure);\r\n                  }\r\n                  \r\n                  $timeout(function() {\r\n                     deferred.resolve(savedStatus);\r\n                  });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to retrieve existing cache data\r\n            * key must be defined\r\n            * @param {key} the key for data to be retrieved\r\n            */\r\n           localIndexedDB.get = localIndexedDB.getItem = function(key) {\r\n              var deferred = $q.defer();\r\n              var db = localIndexedDB.db;\r\n              if (!db) {\r\n                  var errorMessage = \"localIndexedDB is not available\";\r\n                  console.warn(errorMessage);\r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n                 return deferred.promise;\r\n              }\r\n\r\n              // use entity object store in read-write manner\r\n              var trans = db.transaction([localIndexedDB.entityName], \"readonly\");\r\n              var objectStore = trans.objectStore(localIndexedDB.entityName);\r\n\r\n              var request = objectStore.get(key);\r\n              var data = null;\r\n\r\n              request.onsuccess = function(e) {\r\n                 if (e.target.result) {\r\n                    data = e.target.result;\r\n                 }\r\n                 \r\n                 $timeout(function() {\r\n                    deferred.resolve(data);\r\n                 });\r\n              };\r\n\r\n              request.onerror = function(e) {\r\n                  var errorMessage =  \"couldn't retrieved value for key: \" + key + \". error: \" + e.message;\r\n                  console.warn(errorMessage);\r\n                 \r\n                  $timeout(function() {\r\n                     deferred.resolve(data);\r\n                  });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to delete an existing cache data\r\n            * key must be defined and part of exisiting keys\r\n            * @param {key} the key for data to be deleted\r\n            */\r\n           localIndexedDB.remove = localIndexedDB.removeItem = function(key) {\r\n              var deferred = $q.defer();\r\n              var db = localIndexedDB.db;\r\n              if (!db) {\r\n                  var errorMessage = \"localIndexedDB is not available\";\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n                 \r\n                 return deferred.promise;\r\n              }\r\n\r\n              // use entity object store in read-write manner\r\n              var trans = db.transaction([localIndexedDB.entityName], \"readwrite\");\r\n              var objectStore = trans.objectStore(localIndexedDB.entityName);\r\n\r\n              // yui compressor is not happy with objectStore.delete.key\r\n              var request = objectStore[\"delete\"](key);\r\n\r\n              request.onsuccess = function() {\r\n                  $timeout(function() {\r\n                    deferred.resolve();\r\n                 });\r\n              };\r\n\r\n              request.onerror = function(e) {\r\n                  var errorMessage = \"couldn't remove value for key: \" + key + \". error: \" + e.message;\r\n                 console.warn(errorMessage);\r\n                 \r\n                 $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to clear entire cache space\r\n            */\r\n           localIndexedDB.clear = function() {\r\n              var deferred = $q.defer();\r\n              var db = localIndexedDB.db;\r\n              if (!db) {\r\n                  var errorMessage = \"localIndexedDB is not available\";\r\n                  console.warn(errorMessage);\r\n\r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n                 \r\n                 return deferred.promise;\r\n              }\r\n\r\n              // use entity object store in read-write manner\r\n              var trans = db.transaction([localIndexedDB.entityName], \"readwrite\");\r\n              var objectStore = trans.objectStore(localIndexedDB.entityName);\r\n              var request = objectStore.clear();\r\n\r\n              request.onsuccess = function () {\r\n                  console.log(localIndexedDB.dbName + \" indexedDB data cleared\");\r\n\r\n                  $timeout(function() {\r\n                    deferred.resolve();\r\n                 });\r\n              };\r\n\r\n              request.onerror = function(e) {\r\n                  var errorMessage = \"couldn't clear content of indexedDB: \" + localIndexedDB.dbName + \". error: \" + e.message;\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n\r\n              request.onblocked = function (e) {\r\n                  var errorMessage = \"couldn't clear content of indexedDB: \" + localIndexedDB.dbName + \" due to operation being blocked. error: \" + e.message;\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to compute current size of cache, as per number of cache items\r\n            */\r\n           localIndexedDB.length = function() {\r\n              var deferred = $q.defer();\r\n              var db = localIndexedDB.db;\r\n              if (!db) {\r\n                  var errorMessage = \"localIndexedDB is not available\";\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              }\r\n\r\n              // use entity object store in read-write manner\r\n              var trans = db.transaction([localIndexedDB.entityName], \"readwrite\");\r\n              var objectStore = trans.objectStore(localIndexedDB.entityName);\r\n              var request = objectStore.count();\r\n\r\n              request.onsuccess = function () {\r\n                  $timeout(function() {\r\n                    deferred.resolve(request.result);\r\n                 });\r\n              };\r\n\r\n              request.onerror = function(e) {\r\n                  var errorMessage = \"couldn't clear compute size of indexedDB: \" + localIndexedDB.dbName + \". error: \" + e.message;\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n\r\n         /**\r\n         * This storage object help abstract the basic functionalities of WebSQL.\r\n         */\r\n        var localWebSQL = {};\r\n           // database version\r\n           localWebSQL.version = \"1.0\";\r\n           // marker for localIndexedDB\r\n           localWebSQL.name = \"webSQL\";\r\n           // database name\r\n           localWebSQL.dbName = \"cacheDB\";\r\n           // entity name\r\n           localWebSQL.entityName = \"cacheTable\";\r\n           // database description\r\n           localWebSQL.dbDescription = localWebSQL.dbName;\r\n           // database size\r\n           localWebSQL.dbSize = 5 * 1024 * 1024;\r\n           // entity size\r\n           localWebSQL.entitySize = 0;\r\n           // database options\r\n           localWebSQL.options = {};\r\n\r\n           // open the database and configure it appropraitely\r\n           localWebSQL.open = function() {\r\n              var deferred = $q.defer();\r\n              // update dbName and entityName on DB open\r\n              localWebSQL.dbName = localWebSQL.options.dbName;\r\n              localWebSQL.entityName = localWebSQL.options.entityName;\r\n              \r\n              try {\r\n                  if (localWebSQL.db) {\r\n                    $timeout(function() {\r\n                          deferred.resolve();\r\n                     });\r\n                      return deferred.promise;\r\n                  }\r\n\r\n                  // check for webSQL support\r\n                  if (!$window.openDatabase) {\r\n                    var errorMessage = \"webSQL not supported on this device\";\r\n                    console.warn(errorMessage);\r\n                    $timeout(function() {\r\n                      deferred.resolve(null);\r\n                    });\r\n                    return deferred.promise;\r\n                  }\r\n                  \r\n                  // handle for the actual webSQL database\r\n                 localWebSQL.db = $window.openDatabase(localWebSQL.dbName, localWebSQL.version, localWebSQL.dbDescription, localWebSQL.dbSize);\r\n\r\n                 localWebSQL.db.transaction(function (tx) {\r\n                    var createTable = 'CREATE TABLE IF NOT EXISTS ' + localWebSQL.entityName + ' (cacheKey TEXT PRIMARY KEY, cacheValue TEXT)';\r\n                    tx.executeSql(createTable, [], onsuccess, onfailure);\r\n                 });\r\n\r\n                 var onsuccess = function() {\r\n                    $timeout(function() {\r\n                       deferred.resolve(localWebSQL.db);\r\n                    });\r\n                 };\r\n\r\n                 var onfailure = function(tx, e) {\r\n                     var errorMessage = \"\";\r\n                     switch (e.code) \r\n                     {\r\n                        case e.SYNTAX_ERR:\r\n                          errorMessage = \"syntax error has occurred. \" + e.message;\r\n                          console.warn(errorMessage);\r\n                            break;\r\n                        default:\r\n                          errorMessage = \"error creating webSQL table \" + localWebSQL.entityName + \". error: \" + e;\r\n                     }\r\n                     console.warn(errorMessage);\r\n                     \r\n                     $timeout(function() {\r\n                        deferred.resolve(null);\r\n                    });\r\n                 };\r\n              } catch (e) {\r\n                  var errorMessage = \"error creating webSQL database/table. error: \" + e;\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                     deferred.resolve(null);\r\n                 });\r\n              }\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function for caching a data. \r\n            * key must be truthy -> not (null | undefined | NaN | \"\" | 0 | false)\r\n            * @param {key} the key for data to be cached\r\n            * @param {value} the actual data to cache\r\n            */\r\n           localWebSQL.save = localWebSQL.setItem = function(key, value) {\r\n              var deferred = $q.defer();\r\n              var errorMessage = \"\";\r\n              if (!key) {\r\n                  errorMessage = \"invalid key\";\r\n                  console.warn(errorMessage);\r\n                  \r\n                 $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              }\r\n\r\n              if (!localWebSQL.db) {\r\n                  errorMessage = \"localWebSQL.db undefined\";\r\n                  console.warn(errorMessage);\r\n                   \r\n                  $timeout(function() {\r\n                     deferred.reject(errorMessage);\r\n                  });\r\n                 \r\n                  return deferred.promise;\r\n              }\r\n\r\n              var db = localWebSQL.db;\r\n              var savedStatus = false;\r\n              db.transaction(function (tx) {\r\n                  var insertData = 'INSERT INTO ' + localWebSQL.entityName + ' (cacheKey, cacheValue) VALUES (?, ?)';\r\n                 tx.executeSql(insertData, [key, value], oninsertsuccess, onfailure);\r\n              });\r\n\r\n              var oninsertsuccess = function() {\r\n                 savedStatus = true;\r\n                 // invalidate current cached page after specified max period\r\n                 $timeout(function() {\r\n                    localWebSQL.removeItem(key);\r\n                 }, localWebSQL.options.maxAge);\r\n                 \r\n                  $timeout(function() {\r\n                    deferred.resolve(savedStatus);\r\n                 });\r\n              };\r\n              \r\n              var onfailure = function(tx, e) {\r\n                 var errorMessage = \"\";\r\n                 switch (e.code) \r\n                 {\r\n                    case e.SYNTAX_ERR:\r\n                       errorMessage = \"syntax error has occurred. \" + e.message;\r\n                       console.warn(errorMessage);\r\n                        break;\r\n                    default:\r\n                       errorMessage = \"error caching data. error: \" + e.message;\r\n                 }\r\n                 console.warn(errorMessage);\r\n                  \r\n                 $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to retrieve existing cache data\r\n            * key must be defined\r\n            * @param {key} the key for data to be retrieved\r\n            */\r\n           localWebSQL.get = localWebSQL.getItem = function(key) {\r\n              var deferred = $q.defer();\r\n              var errorMessage = \"\";\r\n              if (!localWebSQL.db) {\r\n                 errorMessage = \"localWebSQL.db undefined\";\r\n                 console.warn(errorMessage);\r\n                   \r\n                 $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n                 \r\n                 return deferred.promise;\r\n              }\r\n\r\n              var db = localWebSQL.db;\r\n              db.transaction(function (tx) {\r\n                 var selectData = 'SELECT cacheValue FROM ' + localWebSQL.entityName + ' WHERE cacheKey = ?';\r\n                 tx.executeSql(selectData, [key], onsuccess, onfailure);\r\n              });\r\n              var onsuccess = function(tx, result) {\r\n                 if (result) {\r\n                     var data = null;\r\n                    if (result.rows && result.rows.length) {\r\n                        data = result.rows.item(0).cacheValue;\r\n                    }\r\n                    \r\n                    $timeout(function() {\r\n                       deferred.resolve(data);\r\n                    });\r\n                 }\r\n              };\r\n              \r\n              var onfailure = function(tx, e) {\r\n                  var errorMessage = \"\";\r\n                  switch (e.code) \r\n                  {\r\n                     case e.SYNTAX_ERR:\r\n                       errorMessage = \"syntax error has occurred. \" + e.message;\r\n                       console.warn(errorMessage);\r\n                         break;\r\n                     default:\r\n                       errorMessage = \"error retrieving data. error: \" + e.message;\r\n                  }\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n              \r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to delete an existing cache data\r\n            * key must be defined and part of exisiting keys\r\n            * @param {key} the key for data to be deleted\r\n            */\r\n           localWebSQL.remove = localWebSQL.removeItem = function(key) {\r\n               var deferred = $q.defer();\r\n               var errorMessage = \"\";\r\n               if (!localWebSQL.db) {\r\n                   errorMessage = \"localWebSQL.db undefined\";\r\n                   console.warn(errorMessage);\r\n                   \r\n                   $timeout(function() {\r\n                      deferred.reject(errorMessage);\r\n                   });\r\n                   $timeout.flush();\r\n                 \r\n                  return deferred.promise;\r\n              }\r\n\r\n              var db = localWebSQL.db;\r\n              db.transaction(function (tx) {\r\n                 var deleteData = 'DELETE FROM ' + localWebSQL.entityName + ' WHERE cacheKey = ?';\r\n                 tx.executeSql(deleteData, [key], onsuccess, onfailure);\r\n              });\r\n\r\n              var onsuccess = function() {\r\n                 $timeout(function() {\r\n                    deferred.resolve();\r\n                 });\r\n              };\r\n              \r\n              var onfailure = function(tx, e) {\r\n                  var errorMessage = \"\";\r\n                  switch (e.code) \r\n                  {\r\n                     case e.SYNTAX_ERR:\r\n                       errorMessage = \"syntax error has occurred. \" + e.message;\r\n                       console.warn(errorMessage);\r\n                         break;\r\n                     default:\r\n                       errorMessage = \"error removing data. error: \" + e.message;\r\n                  }\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                     deferred.reject(errorMessage);\r\n                  });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to clear entire cache space\r\n            */\r\n           localWebSQL.clear = function() {\r\n              var deferred = $q.defer();\r\n              var errorMessage = \"\";\r\n              if (!localWebSQL.db) {\r\n                  errorMessage = \"localWebSQL.db yet to be defined\";\r\n                  console.warn(errorMessage);\r\n                   \r\n                  $timeout(function() {\r\n                     deferred.reject(errorMessage);\r\n                  });\r\n                 \r\n                  return deferred.promise;\r\n              }\r\n\r\n              var db = localWebSQL.db;\r\n              var status = false;\r\n              db.transaction(function (tx) {\r\n                  var deleteTable = \"DELETE FROM \" + localWebSQL.entityName;\r\n                  tx.executeSql(deleteTable, [], onsuccess, onfailure);\r\n              });\r\n\r\n              var onsuccess = function() {\r\n                  console.log(localWebSQL.entityName + \" table in \" + localWebSQL.dbName + \" webSQL data cleared\");\r\n                  status = true;\r\n                  \r\n                  $timeout(function() {\r\n                     deferred.resolve(status);\r\n                  });\r\n              };\r\n              \r\n              var onfailure = function(tx, e) {\r\n                  var errorMessage = \"\";\r\n                  switch (e.code) \r\n                  {\r\n                     case e.SYNTAX_ERR:\r\n                       errorMessage = \"syntax error has occurred. \" + e.message;\r\n                       console.warn(errorMessage);\r\n                         break;\r\n                     default:\r\n                       errorMessage = \"couldn't clear content of webSQL: \" + localWebSQL.entityName  + \". error: \" + e.message;\r\n                  }\r\n                  console.warn(errorMessage);\r\n                  \r\n                  $timeout(function() {\r\n                     deferred.reject(errorMessage);\r\n                  });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n           /** \r\n            * Function to compute current size of cache, as per number of cache items\r\n            */\r\n           localWebSQL.length = function() {\r\n              var deferred = $q.defer();\r\n              var errorMessage = \"\";\r\n              if (!localWebSQL.db) {\r\n                  errorMessage = \"localWebSQL.db undefined\";\r\n                  console.warn(errorMessage);\r\n                   \r\n                  $timeout(function() {\r\n                      deferred.reject(errorMessage);\r\n                  });\r\n              }\r\n\r\n              var db = localWebSQL.db;\r\n              \r\n              db.transaction(function (tx) {\r\n                  var tableSize = 'SELECT COUNT(*) AS Size from ' + localWebSQL.entityName;\r\n                 tx.executeSql(tableSize, [], onsuccess, onfailure);\r\n              });\r\n\r\n              var onsuccess = function(tx, result) {\r\n                 if (result && result.rows) {\r\n                    $timeout(function() {\r\n                       deferred.resolve(result.rows.item(0).Size);\r\n                    });\r\n                 }\r\n              };\r\n              \r\n              var onfailure = function(tx, e) {\r\n                 var errorMessage = \"\";\r\n                 switch (e.code) \r\n                 {\r\n                    case e.SYNTAX_ERR:\r\n                       errorMessage = \"syntax error has occurred. \" + e.message;\r\n                       console.warn(errorMessage);\r\n                         break;\r\n                    default:\r\n                       errorMessage = \"error computing current cache size. error: \" + e.message;\r\n                 }\r\n                 console.warn(errorMessage);\r\n\r\n                 $timeout(function() {\r\n                    deferred.reject(errorMessage);\r\n                 });\r\n              };\r\n\r\n              return deferred.promise;\r\n           };\r\n\r\n        /**\r\n          * Utility function for detecting if specified storage type exist\r\n          *\r\n          * @param {storageType} the type of storage to consider\r\n          */\r\n        var storageExist = function(storageType) {\r\n           var uid = (new Date()).valueOf().toString();\r\n           // check if specified storageType allow storage\r\n           var savePromise = storageType.save(uid, uid);\r\n           savePromise.then(function() {\r\n              // delete test data upon successful cache test\r\n              storageType.remove(uid);\r\n           });\r\n           return savePromise;\r\n        };\r\n\r\n        /**\r\n          * Act as the storage handle based on available storage type. This help predetermine possible storage typeon service load. \r\n          * It use either { localStorage | sessionStorage | polyFill } in the specified order of\r\n          * availability. Store can also be configured using the cacheType {LOCAL_STORAGE | SESSION_STORAGE | INDEXED_DB | WEB_SQL | POLY_FILL };\r\n          */\r\n        var store = (function() {\r\n           try {\r\n              storageExist(localStorageDB).then(function(lsdbSavedStatus) {\r\n                 if (lsdbSavedStatus) {\r\n                    // use localStorage directly if available\r\n                    return localStorageDB;\r\n                 } else {\r\n                    storageExist(localSessionStorage).then(function(lssdbSavedStatus) {\r\n                       if (lssdbSavedStatus) {\r\n                          // use sessionStorage directly if available\r\n                          console.log(\"attempting sessionStorage client caching\");\r\n                          return localSessionStorage;\r\n                       } else {\r\n                          // fall back to poly fill data map\r\n                          console.log(\"attempting POLY_FILL client caching\");\r\n                          return POLY_FILL;\r\n                       }\r\n                    });\r\n                 }\r\n              });\r\n           } catch (e) {\r\n              console.error(e.description);\r\n              /* most likely: localStorage and sessionStorage have been disabled by user */\r\n              console.warn(\"....defaulting to POLY_FILL client caching\");\r\n              return POLY_FILL;\r\n           }\r\n        }());\r\n\r\n        // supported cache types\r\n        var cacheType = {LOCAL_STORAGE: 'localStorage', SESSION_STORAGE: 'sessionStorage', INDEXED_DB: 'indexedDB', \"WEB_SQL\": \"webSQL\", POLY_FILL: \"polyFill\"};\r\n\r\n        // configurable options\r\n        var options = {\r\n            /*\r\n             * default database name. applicable to INDEXED_DB | WEB_SQL\r\n             */\r\n            dbName: \"cacheDB\",\r\n            /*\r\n             * default table name. applicable to INDEXED_DB | WEB_SQL\r\n             */\r\n            entityName: \"cacheTable\",\r\n            /*\r\n             * first n-items (default to first 10 items) to be deleted from the cache. this should be used when client storage is full. applicable to\r\n             * LOCAL_STORAGE | SESSION_STORAGE\r\n             */\r\n            deletableCacheItems: 10,\r\n            /*\r\n             * period (in milliseconds) after which each cached data should be deleted. default to 10 min\r\n             */\r\n            maxAge: 600000,\r\n            /*\r\n             * cache type to use: valid options are { localStorage | sessionStorage | indexedDB | webSQL | polyFill }. default to polyFill\r\n             */\r\n            storage: cacheType.POLY_FILL\r\n        };\r\n\r\n        return {\r\n           // supported cache mechanism\r\n           cacheType: cacheType,\r\n           // storage handle\r\n           getStorage: function(){\r\n              return store;\r\n           },\r\n           // storage availability\r\n           storeQuotaExceeded: storeQuotaExceeded,\r\n           // check storage availability and usability\r\n           storageExist: storageExist,\r\n           // configurable options\r\n           options: options,\r\n           // cache service initialization\r\n           init: function(initData) {\r\n              var deferred = $q.defer();\r\n              /* ensure dbName option exist and that it is a valid truthy */\r\n              if (initData && initData.hasOwnProperty('dbName') && initData.dbName) {\r\n                   options.dbName = initData.dbName;\r\n              }\r\n              /* ensure entityName option exist and that it is a valid truthy */\r\n              if (initData && initData.hasOwnProperty('entityName') && initData.entityName) {\r\n                   options.entityName = initData.entityName;\r\n              }\r\n              /* ensure deletableCacheItems option exist and that it is a valid truthy */\r\n              if (initData && initData.hasOwnProperty('deletableCacheItems') && initData.deletableCacheItems) {\r\n                  options.deletableCacheItems = initData.deletableCacheItems;\r\n              }\r\n              /* ensure maxAge option exist and that it is a valid truthy */\r\n              if (initData && initData.hasOwnProperty('maxAge') && initData.maxAge) {\r\n                  options.maxAge = initData.maxAge;\r\n              }\r\n              /* specify storage to use and that cacheType specified is a valid truthy */\r\n              if (initData && initData.hasOwnProperty('cacheType') && initData.cacheType) {\r\n                 options.storage = initData.cacheType;\r\n                 \r\n                 // preprocessor handler for localIndexedDB\r\n                 var indexedDBPreprocessor = function (db) {\r\n                    $timeout(function() {\r\n                       deferred.resolve(db);\r\n                    });\r\n                    store = localIndexedDB;\r\n                    console.info(\"cacheType overriden as indexedDB\");\r\n                    console.log(localIndexedDB.dbName + \" indexedDB database opened\");\r\n                 };\r\n                 // preprocessor handler for localWebSQL\r\n                 var webSQLPreprocessor = function (db) {\r\n                    $timeout(function() {\r\n                       deferred.resolve(db);\r\n                    });\r\n                    store = localWebSQL;\r\n                    console.info(\"cacheType overriden as webSQL\");\r\n                    console.log(localWebSQL.dbName + \" webSQL database opened\");\r\n                 };\r\n                 // preprocessor handler for localStorageDB\r\n                 var localStoragePreprocessor = function (db) {\r\n                    $timeout(function() {\r\n                       deferred.resolve(db);\r\n                    });\r\n                    store = localStorageDB;\r\n                    console.info(\"cacheType overriden as localStorage\");\r\n                    console.log(localStorageDB.dbName + \" localStorage database opened\");\r\n                 };\r\n                 // preprocessor handler for localSessionStorage\r\n                 var sessionStoragePreprocessor = function (db) {\r\n                    $timeout(function() {\r\n                       deferred.resolve(db);\r\n                    });\r\n                    store = localSessionStorage;\r\n                    console.info(\"cacheType overriden as sessionStorage\");\r\n                    console.log(localSessionStorage.dbName + \" sessionStorage database opened\");\r\n                 };\r\n                 // preprocessor handler for POLY_FILL\r\n                 var polyFillPreprocessor = function () {\r\n                    $timeout(function() {\r\n                       deferred.resolve();\r\n                    });\r\n                    store = POLY_FILL;\r\n                    angular.toJson('store: ' + store);\r\n                    console.info(\"cacheType overriden as POLY_FILL\");\r\n                    console.log(POLY_FILL.dbName + \" POLY_FILL database opened\");\r\n                 };\r\n                 \r\n                 /* finalize storage initialization */\r\n                 try {\r\n                    switch (options.storage) {\r\n                       case \"indexedDB\":\r\n                             // fall through if IndexedDB storage is not supported or currently unavailable on client device\r\n                             $window.indexedDB = $window.IndexedDB || $window.mozIndexedDB || $window.webkitIndexedDB || $window.msIndexedDB;\r\n                             if ($window.indexedDB) {\r\n                                // update storage options\r\n                                localIndexedDB.options = options;\r\n                                localIndexedDB.open().then(function(lidb) {\r\n                                   if (lidb) {\r\n                                      indexedDBPreprocessor(lidb);\r\n                                   } else {\r\n                                      // update storage options\r\n                                      localWebSQL.options = options;\r\n                                      localWebSQL.open().then(function(lwdb) {\r\n                                         if (lwdb) {\r\n                                            webSQLPreprocessor(lwdb);\r\n                                         } else {\r\n                                            // update storage options\r\n                                            localStorageDB.options = options;\r\n                                            localStorageDB.open().then(function(lsdb) {\r\n                                               if (lsdb) {\r\n                                                  localStoragePreprocessor(lsdb);\r\n                                               } else {\r\n                                                  // update storage options\r\n                                                  localSessionStorage.options = options;\r\n                                                  localSessionStorage.open().then(function(lssdb) {\r\n                                                     if (lssdb) {\r\n                                                        sessionStoragePreprocessor(lssdb);\r\n                                                     } else {\r\n                                                        // update storage options\r\n                                                        POLY_FILL.options = options;\r\n                                                        polyFillPreprocessor();\r\n                                                     }\r\n                                                  });\r\n                                               }\r\n                                            });\r\n                                         }\r\n                                      });\r\n                                   }\r\n                                });\r\n                             }\r\n                             break;\r\n                          case \"webSQL\":\r\n                             // fall through if WebSQL storage is not supported or currently unavailable on client device\r\n                             if ($window.openDatabase) {\r\n                                // update storage options\r\n                                localWebSQL.options = options;\r\n                                localWebSQL.open().then(function(lwdb) {\r\n                                   if (lwdb) {\r\n                                      webSQLPreprocessor(lwdb);\r\n                                   } else {\r\n                                      // update storage options\r\n                                      localIndexedDB.options = options;\r\n                                      localIndexedDB.open().then(function(lidb) {\r\n                                         if (lidb) {\r\n                                            indexedDBPreprocessor(lidb);\r\n                                         } else {\r\n                                            // update storage options\r\n                                            localStorageDB.options = options;\r\n                                            localStorageDB.open().then(function(lsdb) {\r\n                                               if (lsdb) {\r\n                                                  localStoragePreprocessor(lsdb);\r\n                                               } else {\r\n                                                  // update storage options\r\n                                                  localSessionStorage.options = options;\r\n                                                  localSessionStorage.open().then(function(lssdb) {\r\n                                                     if (lssdb) {\r\n                                                        sessionStoragePreprocessor(lssdb);\r\n                                                     } else {\r\n                                                        // update storage options\r\n                                                        POLY_FILL.options = options;\r\n                                                        polyFillPreprocessor();\r\n                                                     }\r\n                                                  });\r\n                                               }\r\n                                            });\r\n                                         }\r\n                                      });\r\n                                   }\r\n                                });\r\n                             }\r\n                             break;\r\n                          case \"localStorage\":\r\n                             // fall through if localStorage storage is not supported or currently unavailable on client device\r\n                             if ($window.localStorage) {\r\n                                // update storage options\r\n                                localStorageDB.options = options;\r\n                                localStorageDB.open().then(function(lsdb) {\r\n                                   if (lsdb) {\r\n                                      localStoragePreprocessor(lsdb);\r\n                                   } else {\r\n                                      // update storage options\r\n                                      localIndexedDB.options = options;\r\n                                      localIndexedDB.open().then(function(lidb) {\r\n                                         if (lidb) {\r\n                                            indexedDBPreprocessor(lidb);\r\n                                         } else {\r\n                                            // update storage options\r\n                                            localWebSQL.options = options;\r\n                                            localWebSQL.open().then(function(lwdb) {\r\n                                               if (lwdb) {\r\n                                                  webSQLPreprocessor(lwdb);\r\n                                               } else {\r\n                                                  // update storage options\r\n                                                  localSessionStorage.options = options;\r\n                                                  localSessionStorage.open().then(function(lssdb) {\r\n                                                     if (lssdb) {\r\n                                                        sessionStoragePreprocessor(lssdb);\r\n                                                     } else {\r\n                                                        // update storage options\r\n                                                        POLY_FILL.options = options;\r\n                                                        polyFillPreprocessor();\r\n                                                     }\r\n                                                  });\r\n                                               }\r\n                                            });\r\n                                         }\r\n                                      });\r\n                                   }\r\n                                });\r\n                             }\r\n                             break;\r\n                       case \"sessionStorage\":\r\n                          // fall through if sessionStorage storage is not supported or currently unavailable on client device\r\n                             if ($window.sessionStorage) {\r\n                                // update storage options\r\n                                localSessionStorage.options = options;\r\n                                localSessionStorage.open().then(function(lssdb) {\r\n                                   if (lssdb) {\r\n                                      sessionStoragePreprocessor(lssdb);\r\n                                   } else {\r\n                                      // update storage options\r\n                                      localIndexedDB.options = options;\r\n                                      localIndexedDB.open().then(function(lidb) {\r\n                                         if (lidb) {\r\n                                            indexedDBPreprocessor(lidb);\r\n                                         } else {\r\n                                            // update storage options\r\n                                            localWebSQL.options = options;\r\n                                            localWebSQL.open().then(function(lwdb) {\r\n                                               if (lwdb) {\r\n                                                  webSQLPreprocessor(lwdb);\r\n                                               } else {\r\n                                                  // update storage options\r\n                                                  localStorageDB.options = options;\r\n                                                  localStorageDB.open().then(function(lsdb) {\r\n                                                     if (lsdb) {\r\n                                                        localStoragePreprocessor(lsdb);\r\n                                                     } else {\r\n                                                        // update storage options\r\n                                                        POLY_FILL.options = options;\r\n                                                        polyFillPreprocessor();\r\n                                                     }\r\n                                                  });\r\n                                               }\r\n                                            });\r\n                                         }\r\n                                      });\r\n                                   }\r\n                                });\r\n                             }\r\n                             break;\r\n                       case \"polyFill\":\r\n                          // update storage options\r\n                          POLY_FILL.options = options;\r\n                          POLY_FILL.open().then(function() {\r\n                             polyFillPreprocessor();\r\n                          });\r\n                          break;\r\n                    }\r\n                    \r\n                    return deferred.promise;\r\n                 } catch(e) {\r\n                     store = POLY_FILL;\r\n                     // update storage options\r\n                     store.options = options;\r\n                     console.warn(\"chosen cacheType probably not supported...using POLY_FILL as fallback cacheType. error: \" + e);\r\n                 }\r\n              }\r\n           },\r\n           // cache data\r\n           save: function(key, value) {\r\n              return store.save(key, value);\r\n           },\r\n           // remove cached data\r\n           remove: function(key) {\r\n              return store.remove(key);\r\n           },\r\n           // retrieve cached data\r\n           get: function(key) {\r\n              return store.get(key);\r\n           },\r\n           // compute size of cached storage\r\n           length: function() {\r\n              return store.length();\r\n           },\r\n           // clear cache storage\r\n           clear: function() {\r\n              return store.clear();\r\n           }\r\n        };\r\n   };\r\n\r\n   // singleton copy\r\n   var singleton = repository();\r\n   \r\n   // extend cacheStorage\r\n   cacheStorage.prototype.instance = function(){\r\n      return repository();\r\n   };\r\n   \r\n   return {\r\n      getNewInstance : function() {\r\n         return new cacheStorage().instance();\r\n      },\r\n      create : function() {\r\n         return singleton;\r\n      }\r\n   };\r\n} ]);"],"sourceRoot":"/source/"}